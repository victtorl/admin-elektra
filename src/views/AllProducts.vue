<template>
    <div class="   ">


        <div class="border-b mb-5 flex justify-between text-sm  ">
            <div class="text-black flex items-center pb-2 pr-2 border-b-2 border-black uppercase">
                <svg class="h-6 mr-3" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 455.005 455.005"
                    style="enable-background:new 0 0 455.005 455.005;" xml:space="preserve">
                    <g>
                        <path d="M446.158,267.615c-5.622-3.103-12.756-2.421-19.574,1.871l-125.947,79.309c-3.505,2.208-4.557,6.838-2.35,10.343 c2.208,3.505,6.838,4.557,10.343,2.35l125.947-79.309c2.66-1.675,4.116-1.552,4.331-1.432c0.218,0.12,1.096,1.285,1.096,4.428 c0,8.449-6.271,19.809-13.42,24.311l-122.099,76.885c-6.492,4.088-12.427,5.212-16.284,3.084c-3.856-2.129-6.067-7.75-6.067-15.423 c0-19.438,13.896-44.61,30.345-54.967l139.023-87.542c2.181-1.373,3.503-3.77,3.503-6.347s-1.323-4.974-3.503-6.347L184.368,50.615 c-2.442-1.538-5.551-1.538-7.993,0L35.66,139.223C15.664,151.815,0,180.188,0,203.818v4c0,23.63,15.664,52.004,35.66,64.595 l209.292,131.791c3.505,2.207,8.136,1.154,10.343-2.35c2.207-3.505,1.155-8.136-2.35-10.343L43.653,259.72 C28.121,249.941,15,226.172,15,207.818v-4c0-18.354,13.121-42.122,28.653-51.902l136.718-86.091l253.059,159.35l-128.944,81.196 c-20.945,13.189-37.352,42.909-37.352,67.661c0,13.495,4.907,23.636,13.818,28.555c3.579,1.976,7.526,2.956,11.709,2.956 c6.231,0,12.985-2.176,19.817-6.479l122.099-76.885c11.455-7.213,20.427-23.467,20.427-37.004 C455.004,277.119,451.78,270.719,446.158,267.615z"> </path>
                        <path d="M353.664,232.676c2.492,0,4.928-1.241,6.354-3.504c2.207-3.505,1.155-8.136-2.35-10.343l-173.3-109.126 c-3.506-2.207-8.136-1.154-10.343,2.35c-2.207,3.505-1.155,8.136,2.35,10.343l173.3,109.126 C350.916,232.303,352.298,232.676,353.664,232.676z"> </path>
                        <path d="M323.68,252.58c2.497,0,4.938-1.246,6.361-3.517c2.201-3.509,1.14-8.138-2.37-10.338L254.46,192.82 c-3.511-2.202-8.139-1.139-10.338,2.37c-2.201,3.51-1.14,8.138,2.37,10.338l73.211,45.905 C320.941,252.21,322.318,252.58,323.68,252.58z"> </path>
                        <path d="M223.903,212.559c-3.513-2.194-8.14-1.124-10.334,2.39c-2.194,3.514-1.124,8.14,2.39,10.334l73.773,46.062 c1.236,0.771,2.608,1.139,3.965,1.139c2.501,0,4.947-1.251,6.369-3.529c2.194-3.514,1.124-8.14-2.39-10.334L223.903,212.559z"> </path>
                        <path d="M145.209,129.33l-62.33,39.254c-2.187,1.377-3.511,3.783-3.503,6.368s1.345,4.983,3.54,6.348l74.335,46.219 c1.213,0.754,2.586,1.131,3.96,1.131c1.417,0,2.833-0.401,4.071-1.201l16.556-10.7c3.479-2.249,4.476-6.891,2.228-10.37 c-2.248-3.479-6.891-4.475-10.37-2.228l-12.562,8.119l-60.119-37.38l48.2-30.355l59.244,37.147l-6.907,4.464 c-3.479,2.249-4.476,6.891-2.228,10.37c2.249,3.479,6.894,4.476,10.37,2.228l16.8-10.859c2.153-1.392,3.446-3.787,3.429-6.351 c-0.018-2.563-1.344-4.94-3.516-6.302l-73.218-45.909C150.749,127.792,147.647,127.795,145.209,129.33z"> </path>
                        <path d="M270.089,288.846c2.187-3.518,1.109-8.142-2.409-10.329l-74.337-46.221c-3.518-2.188-8.143-1.109-10.329,2.409 c-2.187,3.518-1.109,8.142,2.409,10.329l74.337,46.221c1.232,0.767,2.601,1.132,3.953,1.132 C266.219,292.387,268.669,291.131,270.089,288.846z"> </path>
                        <path d="M53.527,192.864c-2.187,3.518-1.109,8.142,2.409,10.329l183.478,114.081c1.232,0.767,2.601,1.132,3.953,1.132 c2.506,0,4.956-1.256,6.376-3.541c2.187-3.518,1.109-8.142-2.409-10.329L63.856,190.455 C60.338,188.266,55.714,189.346,53.527,192.864z"> </path>
                    </g>
                </svg>
                <a href="#" class="font-semibold inline-block">Lista de productos</a>
            </div>
            <!-- <a href="#">See All</a> -->
        </div>


        <div class="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3  md:grid-cols-3 lg:grid-cols-4  gap-10">


            <!-- CARD 3 -->
            <div  v-for="item in prodST.groupProducts" class="rounded overflow-hidden shadow-lg bg-white flex flex-col ">
                <a  class="font-medium text-lg leading-5 text-center hover:text-black transition duration-500 pt-2 pb-1 ease-in-out inline-block">
                    {{ item.data.marca }}
                </a>

     

                <div class="relative"><a href="#">
                        <img class="w-full h-44 bg-elecktraamarillo  p-6 z-100"
                            :src="item.data.imagenes[0]"
                            alt="">
                        <!-- <div
                            class="hover:bg-transparent transition duration-300 absolute z-10 bottom-0 top-0 right-0 left-0 bg-elecktranegro opacity-25">
                        </div> -->
                    </a>
                    <!-- <a href="#!">
                        <div
                            class="text-xs absolute rounded-lg top-0 right-0 bg-elecktraamarillo px-4 py-2 text-elecktranegro font-semibold mt-3 mr-3 hover:bg-white hover:text-black transition duration-500 ease-in-out">
                            Ver producto
                        </div>
                    </a> -->

                    <a v-if="item.data.oferta">
                      <div
                        class="flex items-center w-full  absolute top-0 text-xs  bg-[#f91515] pl-2 sm:px-4 py-1 text-white font-semibold  hover:bg-elecktraamarillo hover:text-black transition duration-500 ease-in-out">
                        <p class="mt-0 text-xs text-center w-full sm:text-[16px] ">Producto en oferta</p>
                      </div>
                    </a>
                </div>
                <div class="px-6 py-4 mb-auto">
                    <a href="#"
                        class="font-bold text-lg leading-5 text-center hover:text-black transition duration-500 ease-in-out inline-block mb-2">
                    {{ item.data.nombre }}
                    </a>

                    <p class="text-gray-500 text-sm text-center">
                    <span class="text-md font-bold " >Cod</span> {{ item.data.codigo }}
                    </p>
                    <p class="text-gray-500 text-sm text-center">
                    <span class="text-md font-bold " >Unid</span> {{ item.data.medida }}
                    </p>
                 
                </div>
                <div class="px-6 py-3 flex flex-row items-center justify-between  bg-gray-100">
                    <button   @click="selectItemDelete(item)" href="#" class="py-1 text-xs w-20 font-regular hover:bg-red-500 border-[1.5px] bg-white border-black/30 px-2 rounded-md text-gray-900 mr-1 flex flex-row items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                        </svg>
                        <p class="ml-1" >Eliminar</p>
                    
                    </button>
                    <button  @click="gotoEditProduct(item)" class="py-1.5 text-xs w-20 font-regular bg-white border-[1.5px] hover:bg-elektraplomo/50 border-black/30 px-2 rounded-md text-gray-900 mr-1 flex flex-row justify-center items-center">
                       
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                        </svg>
                    



                        <p class="ml-1 text-md " >Editar</p>
                    
                    </button>
                </div>
            </div>

        </div>

    </div>


    <!-- //init modal -->
    <fwb-modal v-if="isShowModal" @close="closeModal">
    <template #header>
      <div class="flex items-center text-center text-lg">
        {{ itemdelete.data.nombre}}
      </div>
    </template>
    <template #body>
      <p class="text-base leading-relaxed text-gray-500 dark:text-gray-400">
        Â¿Esta seguro que dese eliminar este producto? con id {{ itemdelete.id }}
      </p>
    </template>
    <template #footer>
      <div class="flex justify-between">
        <fwb-button @click="closeModal" color="alternative">
          No
        </fwb-button>
        <fwb-button @click="deleteProd(itemdelete)" color="red">
          Si eliminar 
        </fwb-button>
      </div>
    </template>
  </fwb-modal>
    <!-- //end modal -->
</template>
  
  <script setup>
import { FwbButton, FwbModal } from 'flowbite-vue'
import { onMounted,ref } from 'vue';
import { useProductStore } from '../stores/formstore';
import { deleteProductxId, getAllProducts } from '../../firebase';
import router from '../router';



const prodST=useProductStore()  


const gotoEditProduct=(itemedit) => {
    prodST.setEditProduct(itemedit)
    router.push({ name: 'editar-producto', params: { id: itemedit.id } })
    //aseguras que el auxiliar de imagenesEd este limpio y le metes las imagenes que vienen del server
    prodST.clearimagessEd()
    prodST.setimagesEd(itemedit.data.imagenes)
}


const deleteProd=(itemdelete) => {
    deleteProductxId(itemdelete.id)
    getAllProducts()
    closeModal()
}

  ///LLENAR LOS PRODUCTOS AL MONTAR EL COMPONENTE
  onMounted(() => {
    getAllProducts()
  })
  
  
const itemdelete=ref()
const isShowModal = ref(false)
function closeModal () {
  isShowModal.value = false
}
function showModal () {
  isShowModal.value = true
}
const selectItemDelete=(itmselect) => {
   showModal()
   itemdelete.value=itmselect
}

  </script>
  
  <style scoped>
  
  </style>
  